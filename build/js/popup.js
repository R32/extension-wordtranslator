// Generated by Haxe 5.0.0-alpha.1
(function ($global) { "use strict";
class Popup {
	static childIndex(elem) {
		let index = 0;
		let prev = elem.previousSibling;
		while(prev != null) {
			if(prev.nodeType == 1) {
				++index;
			}
			prev = prev.previousSibling;
		}
		return index;
	}
	static updateRedirect(enable) {
		let obj = { };
		obj[enable ? "enableRulesetIds" : "disableRulesetIds"] = ["redirect-googleapi"];
		chrome.declarativeNetRequest.updateEnabledRulesets(obj).catch(function(_) {
		});
	}
	static onChecked(label,checked) {
		if(checked) {
			label.setAttribute("checked","");
		} else {
			label.removeAttribute("checked");
		}
		let menu = document.querySelector("#menumain");
		let ui_redirect = menu.children[2];
		let ui_enable = menu.children[0];
		let ui_sound = menu.children[1];
		let disabled = !checked;
		switch(Popup.childIndex(label)) {
		case 0:
			if(label == ui_enable) {
				Popup.setAttribute(ui_sound,"disabled",disabled);
				Popup.setAttribute(ui_redirect,"disabled",disabled);
				chrome.storage.local.set({ disabled : disabled},function() {
					chrome.runtime.sendMessage([2,"disabled" + ":" + (disabled == null ? "null" : "" + disabled)]);
				});
				if(disabled) {
					Popup.updateRedirect(false);
				} else {
					chrome.storage.local.get(["redirect"],function(stored) {
						Popup.updateRedirect(stored.redirect);
					});
				}
			}
			break;
		case 1:
			if(label == ui_sound) {
				chrome.storage.local.set({ nosound : disabled},function() {
					chrome.runtime.sendMessage([2,"nosound" + ":" + (disabled == null ? "null" : "" + disabled)]);
				});
			}
			break;
		case 2:
			if(label == ui_redirect) {
				chrome.storage.local.set({ redirect : checked},function() {
					Popup.updateRedirect(checked);
				});
			}
			break;
		default:
		}
	}
	static setAttribute(label,value,enable) {
		if(enable) {
			label.setAttribute(value,"");
			label.querySelector("input").setAttribute(value,"");
		} else {
			label.removeAttribute(value);
			label.querySelector("input").removeAttribute(value);
		}
	}
	static main() {
		document.querySelector("#menumain").onclick = function(e) {
			let target = e.target;
			if(target.tagName != "INPUT") {
				return;
			}
			Popup.onChecked(target.parentElement,target.checked);
		};
		chrome.storage.local.get(["nosound","disabled","redirect"],function(stores) {
			let menu = document.querySelector("#menumain");
			if(stores.nosound) {
				Popup.setAttribute(menu.children[1],"checked",false);
			}
			if(stores.disabled) {
				Popup.setAttribute(menu.children[0],"checked",false);
				Popup.setAttribute(menu.children[1],"disabled",true);
				Popup.setAttribute(menu.children[2],"disabled",true);
			}
			if(stores.redirect) {
				Popup.setAttribute(menu.children[2],"checked",true);
			}
		});
	}
}
{
}
Popup.main();
})(window);
